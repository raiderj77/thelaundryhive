{"version":3,"sources":["../../../../src/app/dashboard/billing/page.tsx","../../../../node_modules/%40stripe/stripe-js/dist/index.mjs","../../../../src/lib/stripe.ts"],"sourcesContent":["'use client';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { stripePromise } from '@/lib/stripe';\r\n\r\nexport default function BillingPage() {\r\n  const { user } = useAuth();\r\n\r\n  const handleSubscribe = async () => {\r\n    try {\r\n      // 1. In a real app, this would be a dynamic Price ID from Stripe\r\n      const priceId = 'price_123_test'; \r\n      \r\n      // 2. Call your API to create a Stripe Checkout Session\r\n      const response = await fetch('/api/stripe/checkout', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ \r\n          priceId, \r\n          email: user?.email \r\n        }),\r\n      });\r\n\r\n      const session = await response.json();\r\n\r\n      // 3. Redirect to Stripe Checkout\r\n      const stripe = await stripePromise;\r\n      if (stripe) {\r\n        const { error } = await (stripe as any).redirectToCheckout({\r\n          sessionId: session.id,\r\n        });\r\n        if (error) console.error(error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Subscription failed:', error);\r\n      alert('Could not initiate subscription. Please try again.');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"max-w-2xl mx-auto mt-12 text-center\">\r\n      <h1 className=\"text-3xl font-bold mb-4\">Activate Your Hive</h1>\r\n      <p className=\"text-gray-600 mb-8\">\r\n        Unlock unlimited orders, driver tracking, and route optimization for a flat \r\n        <span className=\"text-blue-600 font-bold\"> $49/month</span>.\r\n      </p>\r\n      \r\n      <div className=\"bg-white p-8 rounded-xl shadow-lg border-2 border-blue-500\">\r\n        <h3 className=\"text-xl font-bold mb-2\">Pro Partner Plan</h3>\r\n        <ul className=\"text-left space-y-3 mb-8\">\r\n          <li>✅ 0% Commission on all orders</li>\r\n          <li>✅ Real-time Driver Tracking</li>\r\n          <li>✅ AI Route Optimization</li>\r\n          <li>✅ Priority Customer Support</li>\r\n        </ul>\r\n        <button \r\n          onClick={handleSubscribe}\r\n          className=\"w-full bg-blue-600 text-white py-4 rounded-lg font-bold text-lg hover:bg-blue-700 transition\"\r\n        >\r\n          Start Your Subscription\r\n        </button>\r\n      </div>\r\n      <p className=\"text-sm text-gray-400 mt-6\">\r\n        Secure payment processing by Stripe. Cancel anytime.\r\n      </p>\r\n    </div>\r\n  );\r\n}\r\n","var RELEASE_TRAIN = 'clover';\n\nvar runtimeVersionToUrlVersion = function runtimeVersionToUrlVersion(version) {\n  return version === 3 ? 'v3' : version;\n};\n\nvar ORIGIN = 'https://js.stripe.com';\nvar STRIPE_JS_URL = \"\".concat(ORIGIN, \"/\").concat(RELEASE_TRAIN, \"/stripe.js\");\nvar V3_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/v3\\/?(\\?.*)?$/;\nvar STRIPE_JS_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/(v3|[a-z]+)\\/stripe\\.js(\\?.*)?$/;\nvar EXISTING_SCRIPT_MESSAGE = 'loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used';\n\nvar isStripeJSURL = function isStripeJSURL(url) {\n  return V3_URL_REGEX.test(url) || STRIPE_JS_URL_REGEX.test(url);\n};\n\nvar findScript = function findScript() {\n  var scripts = document.querySelectorAll(\"script[src^=\\\"\".concat(ORIGIN, \"\\\"]\"));\n\n  for (var i = 0; i < scripts.length; i++) {\n    var script = scripts[i];\n\n    if (!isStripeJSURL(script.src)) {\n      continue;\n    }\n\n    return script;\n  }\n\n  return null;\n};\n\nvar injectScript = function injectScript(params) {\n  var queryString = params && !params.advancedFraudSignals ? '?advancedFraudSignals=false' : '';\n  var script = document.createElement('script');\n  script.src = \"\".concat(STRIPE_JS_URL).concat(queryString);\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe, startTime) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"8.6.0\",\n    startTime: startTime\n  });\n};\n\nvar stripePromise$1 = null;\nvar onErrorListener = null;\nvar onLoadListener = null;\n\nvar onError = function onError(reject) {\n  return function (cause) {\n    reject(new Error('Failed to load Stripe.js', {\n      cause: cause\n    }));\n  };\n};\n\nvar onLoad = function onLoad(resolve, reject) {\n  return function () {\n    if (window.Stripe) {\n      resolve(window.Stripe);\n    } else {\n      reject(new Error('Stripe.js not available'));\n    }\n  };\n};\n\nvar loadScript = function loadScript(params) {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise$1 !== null) {\n    return stripePromise$1;\n  }\n\n  stripePromise$1 = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe && params) {\n      console.warn(EXISTING_SCRIPT_MESSAGE);\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    try {\n      var script = findScript();\n\n      if (script && params) {\n        console.warn(EXISTING_SCRIPT_MESSAGE);\n      } else if (!script) {\n        script = injectScript(params);\n      } else if (script && onLoadListener !== null && onErrorListener !== null) {\n        var _script$parentNode;\n\n        // remove event listeners\n        script.removeEventListener('load', onLoadListener);\n        script.removeEventListener('error', onErrorListener); // if script exists, but we are reloading due to an error,\n        // reload script to trigger 'load' event\n\n        (_script$parentNode = script.parentNode) === null || _script$parentNode === void 0 ? void 0 : _script$parentNode.removeChild(script);\n        script = injectScript(params);\n      }\n\n      onLoadListener = onLoad(resolve, reject);\n      onErrorListener = onError(reject);\n      script.addEventListener('load', onLoadListener);\n      script.addEventListener('error', onErrorListener);\n    } catch (error) {\n      reject(error);\n      return;\n    }\n  }); // Resets stripePromise on error\n\n  return stripePromise$1[\"catch\"](function (error) {\n    stripePromise$1 = null;\n    return Promise.reject(error);\n  });\n};\nvar initStripe = function initStripe(maybeStripe, args, startTime) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var pk = args[0];\n  var isTestKey = pk.match(/^pk_test/); // @ts-expect-error this is not publicly typed\n\n  var version = runtimeVersionToUrlVersion(maybeStripe.version);\n  var expectedVersion = RELEASE_TRAIN;\n\n  if (isTestKey && version !== expectedVersion) {\n    console.warn(\"Stripe.js@\".concat(version, \" was loaded on the page, but @stripe/stripe-js@\").concat(\"8.6.0\", \" expected Stripe.js@\").concat(expectedVersion, \". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning\"));\n  }\n\n  var stripe = maybeStripe.apply(undefined, args);\n  registerWrapper(stripe, startTime);\n  return stripe;\n}; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\nvar stripePromise;\nvar loadCalled = false;\n\nvar getStripePromise = function getStripePromise() {\n  if (stripePromise) {\n    return stripePromise;\n  }\n\n  stripePromise = loadScript(null)[\"catch\"](function (error) {\n    // clear cache on error\n    stripePromise = null;\n    return Promise.reject(error);\n  });\n  return stripePromise;\n}; // Execute our own script injection after a tick to give users time to do their\n// own script injection.\n\n\nPromise.resolve().then(function () {\n  return getStripePromise();\n})[\"catch\"](function (error) {\n  if (!loadCalled) {\n    console.warn(error);\n  }\n});\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  var startTime = Date.now(); // if previous attempts are unsuccessful, will re-load script\n\n  return getStripePromise().then(function (maybeStripe) {\n    return initStripe(maybeStripe, args, startTime);\n  });\n};\n\nexport { loadStripe };\n","import { loadStripe } from '@stripe/stripe-js';\r\n\r\nexport const stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY!);\r\n\r\nexport const createCheckoutSession = async (priceId: string, customerEmail: string) => {\r\n  const response = await fetch('/api/checkout', {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ priceId, customerEmail }),\r\n  });\r\n  const session = await response.json();\r\n  return session.id;\r\n};\r\n"],"names":[],"mappings":"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","ignoreList":[1]}